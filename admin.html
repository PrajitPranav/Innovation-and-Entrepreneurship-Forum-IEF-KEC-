<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IEF Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            background: #000;
            font-family: 'Raleway', sans-serif;
            color: #fff;
        }

        /* NAVBAR */
        .navbar {
            backdrop-filter: blur(12px);
            background: rgba(0,0,0,0.25);
            padding: 14px 30px;
            position: fixed;
            top: 0; left: 0; right: 0;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }
        .navbar-brand {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
        }

        .container {
            padding: 120px 30px 40px;
            max-width: 1100px;
            margin: auto;
        }

        h2 {
            margin-bottom: 10px;
            font-weight: 700;
        }

        .card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 12px;
            font-size: 15px;
        }

        button {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
        }

        .btn-primary {
            background: #fff;
            color: #000;
        }
        .btn-primary:hover {
            background: #ccc;
        }

        .table-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table-list th, .table-list td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .delete-btn {
            background: #e63946;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
        }
        .delete-btn:hover {
            background: #ff5c5c;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="navbar-brand">IEF â€¢ Admin Panel</div>
</nav>

<div class="container">

    <!-- ADD USER SECTION -->
    <div class="card">
        <h2>Add User (Student or Staff)</h2>

        <label>Role</label>
        <select id="role">
            <option value="student">Student</option>
            <option value="staff">Staff</option>
        </select>

        <label>Email (must end with @kongu.edu)</label>
        <input type="email" id="email" placeholder="example@kongu.edu">

        <label>Username (Roll No for students, Email for staff)</label>
        <input type="text" id="username">

        <button class="btn-primary" onclick="addUser()">Add User</button>

        <p id="msg"></p>
    </div>

    <!-- USER LIST -->
    <div class="card">
        <h2>Existing Users</h2>
        <table class="table-list">
            <thead>
            <tr>
                <th>Role</th>
                <th>Username</th>
                <th>Email</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody id="userList"></tbody>
        </table>
    </div>

</div>

<script>
const API = "http://localhost:4000";

// Add User
async function addUser() {
    const role = document.getElementById("role").value;
    const email = document.getElementById("email").value.trim();
    const username = document.getElementById("username").value.trim();
    const msg = document.getElementById("msg");

    msg.textContent = "";

    if (!email.endsWith("@kongu.edu")) {
        msg.textContent = "Email must end with @kongu.edu";
        msg.style.color = "red";
        return;
    }

    if (username.length < 3) {
        msg.textContent = "Username too short";
        msg.style.color = "red";
        return;
    }

    const body = {
        role,
        email,
        username
        // password = username (server handles this)
    };

    try {
        const res = await fetch(`${API}/api/users`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        const data = await res.json();

        if (data.success) {
            msg.textContent = "User added successfully!";
            msg.style.color = "lightgreen";
            document.getElementById("email").value = "";
            document.getElementById("username").value = "";
            loadUsers();
        } else {
            msg.textContent = data.error || "Something went wrong";
            msg.style.color = "red";
        }
    } catch (err) {
        msg.textContent = "Server connection failed";
        msg.style.color = "red";
        console.error(err);
    }
}

// Load all users
async function loadUsers() {
    const res = await fetch(`${API}/api/users`);
    const data = await res.json();

    const tbody = document.getElementById("userList");
    tbody.innerHTML = "";

    if (!data.items || data.items.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>No users found</td></tr>";
        return;
    }

    data.items.forEach(u => {
        tbody.innerHTML += `
            <tr>
                <td>${u.role}</td>
                <td>${u.username}</td>
                <td>${u.email}</td>
                <td>
                    <button class="delete-btn" onclick="deleteUser('${u._id}')">Delete</button>
                </td>
            </tr>
        `;
    });
}

// Delete user
async function deleteUser(id) {
    if (!confirm("Are you sure you want to delete this user?")) return;

    await fetch(`${API}/api/users/${id}`, { method: "DELETE" });
    loadUsers();
}

loadUsers();
</script>


</body>
</html>
