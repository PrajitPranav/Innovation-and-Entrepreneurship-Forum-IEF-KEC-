<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IEF Membership Application</title>

  <!-- Bootstrap (optional, used for basic layout) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />

  <!-- Raleway -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --page-bg: #000;
      --card-bg: rgba(255,255,255,0.04);
      --glass: rgba(255,255,255,0.06);
      --muted: #bfc8d3;
    }

    body {
      margin: 0;
      font-family: 'Raleway', sans-serif;
      background: linear-gradient(180deg,#050509 0%, #0b0f17 100%);
      color: #fff;
      min-height: 100vh;
    }

    /* NAVBAR */
    .navbar {
      backdrop-filter: blur(12px);
      background-color: rgba(0,0,0,0.35);
      padding: 12px 28px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .navbar .brand { font-size: 26px; font-weight:700; color:#fff; letter-spacing:1px; }
    .navbar .links a { color: var(--muted); margin-left:18px; text-decoration:none; font-size:15px; }
    .navbar .links a:hover { color:#fff; }

    /* CONTENT */
    .page-wrap { padding: 110px 20px 40px; display:flex; justify-content:center; }

    .form-card {
      width: 100%;
      max-width: 820px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius: 14px;
      padding: 28px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 8px 40px rgba(0,0,0,0.6);
    }

    .form-title { text-align:center; font-size:26px; font-weight:700; margin-bottom:14px; color:#fff; }
    .muted { color: var(--muted); font-size:14px; }

    label { font-weight:600; color:#e8eef8; font-size:14px; margin-bottom:6px; display:block; }
    .form-control, .form-select, textarea {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.04);
      color: #fff;
      padding: 10px 12px;
      border-radius:8px;
    }
    .form-control:focus, .form-select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 6px 18px rgba(79,70,229,0.08);
      border-color: rgba(79,70,229,0.6);
    }

    .row-gap { display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width: 760px) { .row-gap { grid-template-columns: 1fr; } }

    .btn-primary-custom {
      width:100%;
      background: #fff;
      color:#000;
      padding: 12px;
      border-radius:10px;
      font-weight:700;
      border:none;
      cursor:pointer;
    }
    .btn-primary-custom[disabled] { opacity:0.6; cursor:not-allowed; }

    .note { margin-top:12px; font-size:13px; color:var(--muted); }

    .alert {
      padding: 10px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      font-weight:600;
    }
    .alert-success { background: rgba(16,185,129,0.12); color:#10b981; border:1px solid rgba(16,185,129,0.12); }
    .alert-error { background: rgba(239,68,68,0.08); color:#ef4444; border:1px solid rgba(239,68,68,0.08); }

    .small-muted { color:var(--muted); font-size:13px; }

  </style>
</head>
<body>

  <nav class="navbar">
    <div class="brand">KEC - IEF</div>
    <div class="links">
      <a href="index.html">Home</a>
      <a href="calendar.html">Events</a>
      <a href="contact.html">Contact</a>
    </div>
  </nav>

  <div class="page-wrap">
    <div class="form-card">
      <div class="form-title">IEF Membership Registration</div>

      <div id="message"></div>

      <form id="membershipForm" autocomplete="off" novalidate>
        <div class="row-gap">
          <div>
            <label for="fullName">Full Name</label>
            <input id="fullName" name="fullName" class="form-control" type="text" required />
          </div>

          <div>
            <label for="rollno">Roll Number / Register No</label>
            <input id="rollno" name="rollno" class="form-control" type="text" required />
          </div>
        </div>

        <div class="row-gap" style="margin-top:12px;">
          <div>
            <label for="dob">Date of Birth</label>
            <input id="dob" name="dob" class="form-control" type="date" required />
          </div>

          <div>
            <label for="gender">Gender</label>
            <select id="gender" name="gender" class="form-select" required>
              <option value="">Select Gender</option>
              <option>Male</option>
              <option>Female</option>
              <option>Prefer not to say</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label for="emailPersonal">Personal Email</label>
          <input id="emailPersonal" name="emailPersonal" class="form-control" type="email" placeholder="abc@gmail.com" required />
        </div>

        <div style="margin-top:12px;">
          <label for="emailKongu">Kongu.edu Email</label>
          <input id="emailKongu" name="emailKongu" class="form-control" type="email" placeholder="abc@kongu.edu" required />
          <div class="small-muted" id="konguNote">Please use your official Kongu.edu email.</div>
        </div>

        <div class="row-gap" style="margin-top:12px;">
          <div>
            <label for="phone">Phone / WhatsApp</label>
            <input id="phone" name="phone" class="form-control" type="tel" placeholder="10-digit number" pattern="[0-9]{10}" required />
          </div>

          <div>
            <label for="department">Department</label>
            <select id="department" name="department" class="form-select" required>
              <option value="">Select Department</option>
              <option>CSE</option>
              <option>ECE</option>
              <option>EEE</option>
              <option>MECH</option>
              <option>CIVIL</option>
              <option>IT</option>
              <option>BME</option>
              <option>Biotech</option>
            </select>
          </div>
        </div>

        <div class="row-gap" style="margin-top:12px;">
          <div>
            <label for="year">Year</label>
            <select id="year" name="year" class="form-select" required>
              <option value="">Select Year</option>
              <option>I</option>
              <option>II</option>
              <option>III</option>
              <option>IV</option>
              <option>MBA/MCA</option>
            </select>
          </div>

          <div>
            <label for="section">Section (optional)</label>
            <input id="section" name="section" class="form-control" type="text" placeholder="A / B / C..." />
          </div>
        </div>

        <div style="margin-top:12px;">
          <label for="skills">Skills / Interests (comma separated)</label>
          <input id="skills" name="skills" class="form-control" type="text" placeholder="Web, AI, Robotics..." />
        </div>

        <div style="margin-top:12px;">
          <label for="reason">Why do you want to join IEF?</label>
          <textarea id="reason" name="reason" class="form-control" rows="3" required></textarea>
        </div>

        <div style="display:flex; gap:12px; margin-top:14px; align-items:center;">
          <input id="agree" type="checkbox" required />
          <label for="agree" class="muted" style="margin:0;">I confirm the details are correct and permit staff to view them.</label>
        </div>

        <div style="margin-top:18px;">
          <button id="submitBtn" class="btn-primary-custom" type="submit">Submit Application</button>
        </div>

        <div class="note">After submission, staff will review registrations. Only staff can view or delete registrations.</div>
      </form>
    </div>
  </div>

  <script>
    // API base - change if your server runs on another host/port
    const API = (window.location.hostname === 'localhost') ? 'http://localhost:4000' : '';

    const form = document.getElementById('membershipForm');
    const submitBtn = document.getElementById('submitBtn');
    const messageBox = document.getElementById('message');

    function showMessage(type, text) {
      messageBox.innerHTML = `<div class="alert ${type === 'ok' ? 'alert-success' : 'alert-error'}">${text}</div>`;
      setTimeout(()=> messageBox.innerHTML = '', 5000);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // simple client validation
      const data = Object.fromEntries(new FormData(form).entries());

      // Kongu email check
      if (!data.emailKongu || !data.emailKongu.toLowerCase().endsWith('@kongu.edu')) {
        showMessage('err', 'Please enter a valid Kongu.edu email (e.g. abc@kongu.edu).');
        return;
      }

      // phone basic check (10 digits)
      if (!/^\d{10}$/.test(data.phone || '')) {
        showMessage('err', 'Please enter a valid 10-digit phone number.');
        return;
      }

      // required fields double-check
      const required = ['fullName','rollno','dob','gender','emailPersonal','emailKongu','phone','department','year','reason'];
      for (const key of required) {
        if (!data[key] || data[key].trim() === '') {
          showMessage('err', 'Please fill all required fields.');
          return;
        }
      }

      // add timestamp (server will also set timestamp)
      data.submittedAt = new Date().toISOString();

      // UI changes while submitting
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      try {
        const res = await fetch((API || '') + '/api/members', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const json = await res.json();
        if (json.success) {
          showMessage('ok', 'Application submitted — your details have been sent to staff.');
          form.reset();
        } else {
          console.error(json);
          showMessage('err', 'Submission failed: ' + (json.error || 'Server error'));
        }
      } catch (err) {
        console.error(err);
        showMessage('err', 'Submission failed — check console or server.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application';
      }
    });
  </script>

</body>
</html>
