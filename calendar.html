<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KEC-IEF — Events</title>
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body{font-family:'Raleway',sans-serif;background:#000;color:#fff;margin:0}
  .navbar{backdrop-filter:blur(10px);background:rgba(0,0,0,0.35);padding:12px 24px;position:fixed;top:0;width:100%;z-index:20}
  .container{padding:90px 24px}
  .layout{display:flex;gap:20px}
  .left,.right{flex:1;background:#0f0f10;padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:12px}
  .day-label{background:#222;padding:8px;border-radius:6px;text-align:center;font-weight:600}
  .day{background:#111;padding:12px;border-radius:8px;min-height:48px;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .day:hover{transform:translateY(-2px)}
  .event-day{background:cornflowerblue;color:#000;font-weight:700}
  .selected{outline:3px solid #fff}
  .controls{display:flex;gap:8px;align-items:center}
  .muted{color:#9aa4b2}
</style>
</head>
<body>
  <div class="navbar">
    <span style="font-weight:700">KEC-IEF</span>
  </div>

  <div class="container">
    <div class="controls">
      <select id="yearSelect"></select>
      <select id="monthSelect"></select>
    </div>

    <div class="layout" style="margin-top:12px">
      <div class="left">
        <h3>Select Date</h3>
        <div id="calendar" class="calendar"></div>
      </div>

      <div class="right">
        <h3>Event Details</h3>
        <div id="event-details" class="muted">Select a date to see events</div>
      </div>
    </div>
  </div>

<script>
  const API = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'http://localhost:4000' : '';
  let events = []; // loaded from server
  let currentYear = new Date().getFullYear();
  let currentMonth = new Date().getMonth();

  function fetchEvents() {
    // load all events (could pass from/to by query if needed)
    return fetch((API||'') + '/api/events')
      .then(r => r.json())
      .then(j => j.success ? j.items : [])
      .catch(e => { console.error(e); return []; });
  }

  function populateMonthSelect() {
    const monthSelect = document.getElementById('monthSelect');
    monthSelect.innerHTML = '';
    for (let i=0;i<12;i++){
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = new Date(2024,i).toLocaleString('default',{month:'long'});
      monthSelect.appendChild(opt);
    }
    monthSelect.value = currentMonth;
  }

  function populateYearSelect() {
    const y = document.getElementById('yearSelect');
    y.innerHTML = '';
    const start = currentYear - 2;
    for (let i=0;i<5;i++){
      const yr = start + i;
      const o = document.createElement('option'); o.value = yr; o.textContent = yr; y.appendChild(o);
    }
    y.value = currentYear;
  }

  function renderCalendar() {
    currentYear = Number(document.getElementById('yearSelect').value);
    currentMonth = Number(document.getElementById('monthSelect').value);
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = '';

    const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    days.forEach(d => {
      const el = document.createElement('div'); el.className='day-label'; el.textContent = d; calendar.appendChild(el);
    });

    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const lastDate = new Date(currentYear, currentMonth+1, 0).getDate();

    for (let i=0;i<firstDay;i++) calendar.appendChild(document.createElement('div'));

    for (let day=1; day<=lastDate; day++){
      const div = document.createElement('div');
      div.className = 'day';
      div.textContent = day;
      const iso = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

      // find events on this date
      const evs = events.filter(e => e.date === iso);
      if (evs.length) div.classList.add('event-day');

      div.addEventListener('click', () => {
        document.querySelectorAll('.day').forEach(d=>d.classList.remove('selected'));
        div.classList.add('selected');
        showEventsForDate(iso);
      });

      calendar.appendChild(div);
    }
  }

  function showEventsForDate(iso) {
    const evs = events.filter(e => e.date === iso);
    const details = document.getElementById('event-details');
    if (!evs.length) {
      details.innerHTML = `<div class="muted">No events on ${new Date(iso).toDateString()}</div>`;
      return;
    }
    details.innerHTML = evs.map(e => `
      <div style="margin-bottom:12px">
        <strong>${escapeHtml(e.title)}</strong><div class="muted">${escapeHtml(e.time)} • ${escapeHtml(e.venue)}</div>
        <div style="margin-top:6px">${escapeHtml(e.description || '')}</div>
      </div>
    `).join('');
  }

  function escapeHtml(s=''){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  async function init() {
    populateMonthSelect(); populateYearSelect();
    document.getElementById('yearSelect').addEventListener('change', renderCalendar);
    document.getElementById('monthSelect').addEventListener('change', renderCalendar);

    events = await fetchEvents();
    renderCalendar();
  }

  init();
</script>
</body>
</html>
